/*! (c) 2016 Yonghui Lin (MIT) */
!function(t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ProgressTimer=e()}(this,function(){function t(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function e(){}function i(t){return t=t||{},this instanceof i?(this.interval=t.interval||1e3/60,this.total=t.total||1/0,void this._init()):new i(t)}function s(){var t=this;if(t._state!==o.STARTED)return t;if(t._currentTime>=t.total)return setTimeout(function(){t._changeState(o.COMPLETED)},0),t;var e=t.interval,i=n()-t._start_at-t._pause_time;i=i>t.total?t.total:i,t._changeCurrentTime(i);var r=n()-(t._start_at+t._currentTime+t._offset),a=r>0?e-r:e;return t.emit("interval",t._currentTime,t),t._timeout=setTimeout(s.bind(t),a),t}var r=Array.prototype.slice;"function"!=typeof Object.create&&(Object.create=function(t){var e=function(){};return function(i,s){if(i!==Object(i)&&null!==i)throw TypeError("Argument must be an object, or null");e.prototype=i||{},s!==t&&Object.defineProperties(e.prototype,s);var r=new e;return e.prototype=null,null===i&&(r.__proto__=null),r}}());var n="undefined"!=typeof performance&&performance.now.bind(performance)||Date.now||function(){return+new Date};e.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},emit:function(t){if(this._events=this._events||{},t in this._events)for(var e=this._events[t]||[],i=r.call(arguments,1),s=e.length,n=0;n<s;n++)e[n].apply(this,i)}};var o=i.STATE={INIT:"init",STARTED:"started",PAUSE:"pause",COMPLETED:"completed"};return t(i,e),i.prototype._init=function(){this._clearTimeout(),this._timeout=null,this._changeCurrentTime(0),this._zero(),this._state=o.INIT},i.prototype._zero=function(){this._start_at=null,this._pause_at=0,this._pause_time=0,this._offset=0},i.prototype._changeCurrentTime=function(t){this._currentTime=t<0?0:t>=this.total?this.total:t,this.emit("change",this._currentTime)},i.prototype._clearTimeout=function(){return void 0!==this._timeout&&null!==this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this},i.prototype._changeState=function(t){this._state=t;var e=r.call(arguments,1).concat(this);switch(t){case o.STARTED:this.emit("start",e);break;case o.PAUSE:this.emit("pause",e);break;case o.COMPLETED:this.emit("completed",e)}},i.prototype._stateIs=function(t){return this._state===t},i.prototype.start=function(t){var e=this,i=n();return void 0!==t?(this._clearTimeout(),this._zero(),this._changeCurrentTime(t),this._start_at=i-t,this._changeState(o.STARTED),s.call(this)):this._stateIs(o.STARTED)?e:(this._stateIs(o.PAUSE)&&(e._offset=i-e._pause_at,e._pause_time+=e._offset),this._stateIs(o.INIT)&&(this._start_at=i),this._changeState(o.STARTED),s.call(this))},i.prototype.pause=function(){return this._stateIs(o.INIT)||this._stateIs(o.PAUSE)?this:(this._clearTimeout(),this._pause_at=n(),this._changeState(o.PAUSE),this)},i.prototype.reset=function(){return this._stateIs(o.INIT)?this:(this._init(),this.emit("reset",this),this)},i.prototype.current=function(t){if(void 0!==t){this._zero();var e=n();this._start_at=e-t,this._stateIs(o.STARTED)||(this._state=o.PAUSE,this._pause_at=e),this.emit("seek"),this._changeCurrentTime(t)}return this._currentTime},i.prototype.state=function(){return this._state},i.prototype.currentProgress=function(){return this.total===1/0?0:this._currentTime/this.total},i.prototype.stop=i.prototype.reset,i});